name: Get file summary using OpenAI

on:
  push:
    branches:
      - main

jobs:
  get-file-summary:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Concatenate current and previous file contents
      run: |
        # get the file contents from the current commit
        current_contents=$(cat test.py)

        # print the combined contents
        echo "$current_contents"

      - name: Get previous commit
        run: |
          run: echo "The previous commit was ${{ github.event.before }}"

    - name: Install dependencies
      run: |
        python -m pip install openai

    - name: Call OpenAI code completion API
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        openai api completions.create -m text-davinci-003 -p "Summarize: $(cat test.py)" -t 0.7 -M 256 --stream


